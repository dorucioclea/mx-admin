import{t as $,y as d,H as F,J as D,Q as f,O}from"./app-c79d7097.js";import{T as b}from"./title-link-61b4c986.js";import{D as L}from"./delete-confirm-568dac89.js";import{T as E}from"./index-2c962807.js";import{E as _}from"./edit-column-e7dfc607.js";import{R as B}from"./relative-time-0cb5a8b0.js";import{u as S}from"./use-table-17c69ba1.js";import{k as R}from"./use-store-ref-10b7967e.js";import{H as V}from"./rounded-button-f939e53f.js";import{d as c,a6 as y,a7 as k,a8 as w,ab as z,o as H,b as t,F as T,a as I,Z as h}from"./create-injection-key-6dff4bbb.js";import{N as P}from"./DataTable-ee8322e1.js";import{N as A}from"./Popconfirm-8705d822.js";import{Z as K}from"./Card-720de80b.js";import{b as U}from"./p-d5bd0779.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./ExternalLink-42936135.js";import"./endpoint-d1ee6527.js";import"./category-13d05545.js";import"./Select-a912f9f4.js";import"./light-b93dede2.js";import"./Tag-945120fa.js";import"./_common-991711fd.js";import"./ChevronRight-d32dd5c3.js";import"./Checkbox-130849a4.js";import"./light-4a540c7a.js";import"./light-dcf71249.js";import"./light-758cc2d5.js";import"./light-806b66fd.js";import"./Pagination-b72c8488.js";import"./Forward-d74203eb.js";import"./prop-8b8caa29.js";import"./Tooltip-e8ef26b6.js";import"./light-432a397e.js";const q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 384 512"},Z=w("path",{d:"M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400L0 512z",fill:"currentColor"},null,-1),j=[Z],J=c({name:"Bookmark",render:function(a,l){return y(),k("svg",q,j)}}),Q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},G=w("path",{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z",fill:"currentColor"},null,-1),W=[G],X=c({name:"Heart",render:function(a,l){return y(),k("svg",Q,W)}}),Y={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},ee=w("g",{fill:"none"},[w("path",{d:"M2.854 2.146a.5.5 0 1 0-.708.708l3.5 3.498a8.097 8.097 0 0 0-3.366 5.046a.5.5 0 1 0 .979.204a7.09 7.09 0 0 1 3.108-4.528L7.95 8.656a3.5 3.5 0 1 0 4.884 4.884l4.313 4.314a.5.5 0 0 0 .708-.708l-15-15zm7.27 5.857l3.363 3.363a3.5 3.5 0 0 0-3.363-3.363zM7.53 5.41l.803.803A6.632 6.632 0 0 1 10 6c3.206 0 6.057 2.327 6.74 5.602a.5.5 0 1 0 .98-.204C16.943 7.673 13.693 5 10 5c-.855 0-1.687.143-2.469.41z",fill:"currentColor"})],-1),te=[ee],oe=c({name:"EyeOff20Filled",render:function(a,l){return y(),k("svg",Y,te)}}),C=n=>{const a=String(n).length;return a<4?n:a<7?`${(n/1e3).toFixed(1)}K`:a<10?`${(n/1e6).toFixed(1)}M`:`${(n/1e9).toFixed(1)}B`},Ve=c({name:"NoteList",setup(){const{loading:n,checkedRowKeys:a,data:l,pager:x,sortProps:u,fetchDataFn:N}=S((s,e)=>async(r=v.query.page||1,o=20,g)=>{const p=await d.api.notes.get({params:{db_query:g,page:r,size:o,select:"title _id nid id created modified mood weather hide secret hasMemory coordinates location count",...u.sortBy?{sortBy:u.sortBy,sortOrder:u.sortOrder}:{}}});s.value=p.data,e.value=p.pagination}),m=$(),v=R(),i=N;z(()=>v.query.page,async s=>{await i(s)}),H(async()=>{await i()});const M=c({setup(){const s=I([{type:"selection",options:["none","all"]},{title:"序号",width:64,key:"nid"},{title:"标题",sortOrder:!1,sorter:"default",key:"title",width:280,filter:!0,filterOptions:[{label:"回忆项",value:"hasMemory"},{label:"隐藏项",value:"hide"}],render(e){const r=e.secret&&+new Date(e.secret)-+new Date>0;return t(b,{inPageTo:`/notes/edit?id=${e.id}`,title:e.title,externalLinkTo:`/notes/${e.nid}`,id:e.id,withToken:e.hide||r},{default(){return t(T,null,[e.hide||r?t(f,{color:"#34495e"},{default:()=>[t(oe,null,null)]}):null,e.hasMemory?t(f,{color:"#e74c3c"},{default:()=>[t(J,null,null)]}):null])}})}},{title:"心情",key:"mood",width:100,render(e,r){return t(_,{initialValue:l.value[r].mood??"",onSubmit:async o=>{await d.api.notes(e.id).put({data:{mood:o}}),m.success("修改成功"),l.value[r].mood=o},placeholder:"心情"},null)}},{title:"天气",key:"weather",width:100,render(e,r){return t(_,{initialValue:l.value[r].weather??"",onSubmit:async o=>{await d.api.notes(e.id).put({data:{weather:o}}),m.success("修改成功"),l.value[r].weather=o},placeholder:"天气"},null)}},{title:"地点",key:"location",width:200,render(e){const{coordinates:r,location:o}=e;return o?t(P,{class:"truncate max-w-[200px]"},{tooltip(){return t("div",{class:""},[t("p",null,[o]),t("p",null,[r?.longitude,h(", "),r?.latitude])])},default(){return o}}):null}},{title:()=>t(f,null,{default:()=>[t(O,null,null)]}),key:"count.read",width:50,ellipsis:{tooltip:!0},render(e){return C(e.count?.read||0)}},{title:()=>t(f,null,{default:()=>[t(X,null,null)]}),width:50,ellipsis:{tooltip:!0},key:"count.like",render(e){return C(e.count?.like||0)}},{title:"创建于",key:"created",sortOrder:"descend",sorter:"default",width:200,render(e){return t(B,{time:e.created},null)}},{title:"修改于",key:"modified",sorter:"default",sortOrder:!1,width:200,render(e){return t(B,{time:e.modified},null)}},{title:"操作",key:"id",width:100,fixed:"right",render(e){return t(U,null,{default:()=>[t(A,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await d.api.notes(e.id).delete(),m.success("删除成功"),await i(x.value.currentPage)}},{trigger:()=>t(K,{text:!0,type:"error",size:"tiny"},{default:()=>[h("移除")]}),default:()=>t("span",{class:"max-w-48"},[h("确定要删除 "),e.title,h(" ?")])})]})}}]);return()=>t(E,{nTableProps:{async onUpdateFilters(e,r){const{title:o}=e;if(!o||o.length===0){await i();return}await i(1,void 0,o.reduce((g,p)=>({...g,[p]:!0}),{}))}},loading:n.value,columns:s,data:l,onFetchData:i,pager:x,onUpdateCheckedRowKeys:e=>{a.value=e},onUpdateSorter:async e=>{u.sortBy=e.sortBy,u.sortOrder=e.sortOrder}},null)}});return()=>t(D,null,{actions:()=>t(T,null,[t(L,{checkedRowKeys:a.value,onDelete:async()=>{const s=await Promise.allSettled(a.value.map(e=>d.api.notes(e).delete()));for(const e of s)e.status==="rejected"&&m.success(`删除失败，${e.reason.message}`);a.value.length=0,i()}},null),t(V,{to:"/notes/edit",icon:t(F,null,null)},null)]),default:()=>t(M,null,null)})}});export{Ve as ManageNoteListView};
