import{H as M}from"./rounded-button-fdaf710d.js";import{M as O,T as B,P as H,S as $}from"./parse-content-127df1eb.js";import{E}from"./toggle-26e98f75.js";import{x as m,q as F,M as q,V as D,F as L,R as z}from"./app-0ff7b4dc.js";import{U as A}from"./underline-input-3bb26aa0.js";import{r as W,i as _,f as j,N as Y,I as G}from"./use-store-ref-0c1782ca.js";import{u as J}from"./category-3dece165.js";import{c as K}from"./use-memo-fetch-data-list-eab1ec7d.js";import{N as Q}from"./DynamicTags-b6f051e6.js";import{i as X}from"./isString-f70c4b21.js";import{k as N,R as h,B as Z,n as x,y as p,aq as ee,U as a,F as C,by as te}from"./Button-2747a3c5.js";import{N as n}from"./FormItem-c1d3bab9.js";import{N as b}from"./Select-dd921eae.js";import{N as S}from"./Switch-824c8baa.js";import{N as ae}from"./InputNumber-a17cc659.js";import"./preload-helper-f651ca80.js";import"./marked.esm-75dc6516.js";import"./DatePicker-1348c377.js";import"./fade-in-height-expand.cssr-1f6646e2.js";import"./light-b3f5749e.js";import"./ChevronRight-c663ceb9.js";import"./Forward-5521e015.js";import"./Card-b81187b1.js";import"./Form-72c5e878.js";import"./context-07ff35db.js";import"./light-6e3a4c51.js";import"./light-6243c565.js";import"./ButtonGroup-8bd854df.js";import"./use-async-monaco-326c16e1.js";import"./index-aa2cb20a.js";import"./Spin-3ddc0370.js";import"./editor.main-1c46f4d9.js";import"./editor.api-044d32ac.js";import"./monaco.contribution-6deb0597.js";import"./use-save-confirm-9f66d79e.js";import"./DynamicInput-fc4976c7.js";import"./_common-202f2abd.js";import"./Add-0b9f074d.js";import"./Remove-a535bd80.js";import"./vue.runtime.esm-bundler-785cb4aa.js";import"./js-yaml-e14800c0.js";import"./use-react-2709dd26.js";import"./use-editor-setting-4e6d0894.js";import"./throttle-02eb4430.js";import"./Tag-e8d95e9c.js";import"./_common-991711fd.js";import"./prop-8b8caa29.js";import"./light-a85c2783.js";import"./_common-6222e43f.js";const le=K(f=>m.api.posts.get({params:{page:f,size:50,select:"id title nid _id slug category categoryId"}})),Ze=N(()=>{const f=W(),u=_(J);h(async()=>{await u.fetch()});const R=()=>({categoryId:u.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0,pin:!1,pinOrder:1,relatedId:[],created:void 0}),U=e=>{const l=te(t),s=Object.keys(l);for(const o in e)s.includes(o)&&(t[o]=e[o])},r=le(),t=Z(R()),i=x(()=>f.query.id),g=x(()=>u.get(t.categoryId)||u.data?.value?.[0]||{});h(async()=>{const e=i.value;if(e&&typeof e=="string"){const l=await m.api.posts(e).get();l.data.relatedId=l.data.related?.map(s=>s.id)||[],r.append(l.data.related),U(l.data)}});const v=p(!1),I=F(),P=j(),T=async()=>{const e={...t,categoryId:g.value.id,summary:t.summary&&t.summary.trim()!=""?t.summary.trim():null};if(i.value){if(!X(i.value))return;const l=i.value;await m.api.posts(l).put({data:e}),I.success("修改成功")}else await m.api.posts.post({data:e}),I.success("发布成功");P.push({name:z.ViewPost,hash:"|publish"})},V=()=>{v.value=!0,r.loading.value&&r.fetchNext()},k=e=>{const l=e.currentTarget;l.scrollTop+l.offsetHeight+10>=l.scrollHeight&&r.fetchNext()};return ee(()=>{r.refresh()}),()=>a(L,{title:i.value?"修改文章":"撰写新文章",actionsElement:a(C,null,[a(H,{data:t,onHandleYamlParsedMeta:e=>{const{title:l,slug:s,...o}=e;t.title=l??t.title,t.slug=s??t.slug,t.meta={...o}}},null),a(M,{icon:a(D,null,null),onClick:T},null)]),footerButtonElement:a(C,null,[a("button",{onClick:V},[a(G,null,{default:()=>[a($,null,null)]})])])},{default:()=>[a(O,{class:"mt-3 relative z-10",label:"想想取个什么标题好呢~",value:t.title,onChange:e=>{t.title=e}},null),a("div",{class:"text-gray-500 py-3"},[a("label",{class:"prefix"},[`${q}/${g.value.slug}/`]),a(A,{class:"ml-2",value:t.slug,onChange:e=>{t.slug=e}},null)]),a(E,{loading:!!(i.value&&typeof t.id>"u"),onChange:e=>{t.text=e},text:t.text},null),a(B,{show:v.value,onUpdateShow:e=>{v.value=e},data:t},{default:()=>[a(n,{label:"分类",required:!0,path:"category"},{default:()=>[a(b,{placeholder:"请选择",value:g.value.id,onUpdateValue:e=>{t.categoryId=e},options:u.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),a(n,{label:"标签"},{default:()=>[a(Q,{value:t.tags,onUpdateValue:e=>{t.tags.length=0,t.tags.push(...e)}},{input({submit:e}){return a(N({setup(){const s=p([]),o=p(!1),w=p(""),y=p();return h(async()=>{o.value=!0,y.value&&y.value.$el.querySelector("input").focus();const{data:d}=await m.api.categories.get({params:{type:"Tag"}});s.value=d.map(c=>({label:`${c.name} (${c.count})`,value:c.name,key:c.name})),o.value=!1}),()=>a(b,{ref:y,size:"small",value:w.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:s.value,onUpdateValue:d=>{w.value=d,e(d)}},null)}}),null,null)}})]}),a(n,{label:"关联阅读"},{default:()=>[a(b,{maxTagCount:3,filterable:!0,clearable:!0,loading:r.loading.value,multiple:!0,onClear:()=>{r.refresh()},value:t.relatedId,onUpdateValue:e=>{t.relatedId=e},resetMenuOnOptionsChange:!1,options:r.datalist.value.map(e=>({label:e.title,value:e.id,key:e.id,disabled:e.id==t.id})),onScroll:k},null)]}),a(n,{label:"概要"},{default:()=>[a(Y,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"文章概要",value:t.summary,onInput:e=>void(t.summary=e)},null)]}),a(n,{label:"版权注明",labelAlign:"right",labelPlacement:"left"},{default:()=>[a(S,{value:t.copyright,onUpdateValue:e=>void(t.copyright=e)},null)]}),a(n,{label:"置顶",labelAlign:"right",labelPlacement:"left"},{default:()=>[a(S,{value:!!t.pin,onUpdateValue:e=>{t.pin=e,e||(t.pinOrder=1)}},null)]}),a(n,{label:"置顶顺序",labelAlign:"right",labelPlacement:"left"},{default:()=>[a(ae,{disabled:!t.pin,value:t.pinOrder,onUpdateValue:e=>void(t.pinOrder=e||1)},null)]})]})]})});export{Ze as default};
