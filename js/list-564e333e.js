import{t as x,y as r,H as k,J as D}from"./app-c79d7097.js";import{D as T}from"./delete-confirm-568dac89.js";import{T as F}from"./index-2c962807.js";import{R}from"./relative-time-0cb5a8b0.js";import{u as N}from"./use-table-17c69ba1.js";import{f as b,k as C,j as p}from"./use-store-ref-10b7967e.js";import{H as B}from"./rounded-button-f939e53f.js";import{d as c,ab as S,o as L,b as e,F as M,a as A,Z as i}from"./create-injection-key-6dff4bbb.js";import{Z as d}from"./Card-720de80b.js";import{N as H}from"./Popconfirm-8705d822.js";import{b as K}from"./p-d5bd0779.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./DataTable-ee8322e1.js";import"./ChevronRight-d32dd5c3.js";import"./Checkbox-130849a4.js";import"./light-4a540c7a.js";import"./light-dcf71249.js";import"./light-758cc2d5.js";import"./light-b93dede2.js";import"./light-806b66fd.js";import"./Select-a912f9f4.js";import"./Tag-945120fa.js";import"./_common-991711fd.js";import"./Pagination-b72c8488.js";import"./Forward-d74203eb.js";import"./prop-8b8caa29.js";import"./Tooltip-e8ef26b6.js";import"./light-432a397e.js";const dt=c({name:"SayList",setup(P,V){const{checkedRowKeys:s,data:f,pager:n,loading:y,fetchDataFn:g}=N((a,t)=>async(v=l.query.page||1,w=30)=>{const m=await r.api.says.get({params:{page:v,size:w,select:"title text _id id created modified author source"}});a.value=m.data,t.value=m.pagination}),u=x();b();const l=C(),o=g;S(()=>l.query.page,async a=>{await o(a)}),L(async()=>{await o()});const h=c({setup(){const a=A([{type:"selection",options:["none","all"]},{title:"创建于",key:"created",width:100,render(t){return e(p,{to:`/says/edit?id=${t.id}`},{default:()=>[e(R,{time:t.created},null)]})}},{title:"内容",key:"text"},{title:"作者",key:"author"},{title:"来源",key:"source"},{title:"操作",fixed:"right",key:"id",width:130,render(t){return e(K,{wrap:!1},{default:()=>[e(p,{to:`/says/edit?id=${t.id}`},{default:()=>[e(d,{text:!0,type:"primary",size:"tiny"},{default:()=>[i("编辑")]})]}),e(H,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await r.api.says(t.id).delete(),u.success("删除成功"),await o(n.value.currentPage)}},{trigger:()=>e(d,{text:!0,type:"error",size:"tiny"},{default:()=>[i("移除")]}),default:()=>e("span",{class:"max-w-48"},[i("确定要删除“"),t.text,i("” ?")])})]})}}]);return()=>e(F,{loading:y.value,columns:a,data:f,onFetchData:o,pager:n,onUpdateCheckedRowKeys:t=>{s.value=t}},null)}});return()=>e(D,null,{actions:()=>e(M,null,[e(T,{checkedRowKeys:s.value,onDelete:async()=>{const a=await Promise.allSettled(s.value.map(t=>r.api.says(t).delete()));for(const t of a)t.status==="rejected"&&u.success(`删除失败，${t.reason.message}`);s.value.length=0,o()}},null),e(B,{to:"/says/edit",icon:e(k,null,null)},null)]),default:()=>e(h,null,null)})}});export{dt as default};
