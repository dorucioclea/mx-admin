import{H as N}from"./rounded-button-f939e53f.js";import{y as i,h as x,F as y,K as b,aw as F,a1 as T,ar as k,J as w}from"./app-c79d7097.js";import{T as C}from"./index-2c962807.js";import{b as U,a as B,N as E}from"./Upload-98f221c9.js";import{d as A,r as n,ab as S,o as I,b as t,Z as f,F as M}from"./create-injection-key-6dff4bbb.js";import{N as P,a as d}from"./Tabs-8be888cd.js";import{ag as z,a8 as g,Z as D}from"./Card-720de80b.js";import{N as J}from"./ButtonGroup-229638a3.js";import{N as O}from"./Popconfirm-8705d822.js";import"./use-store-ref-10b7967e.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./p-d5bd0779.js";import"./DataTable-ee8322e1.js";import"./ChevronRight-d32dd5c3.js";import"./Checkbox-130849a4.js";import"./light-4a540c7a.js";import"./light-dcf71249.js";import"./light-758cc2d5.js";import"./light-b93dede2.js";import"./light-806b66fd.js";import"./Select-a912f9f4.js";import"./Tag-945120fa.js";import"./_common-991711fd.js";import"./Pagination-b72c8488.js";import"./Forward-d74203eb.js";import"./prop-8b8caa29.js";import"./Tooltip-e8ef26b6.js";import"./Add-fbc91806.js";import"./light-c32ae781.js";import"./utils-8fb188d9.js";import"./fade-in-height-expand.cssr-0f44db21.js";import"./throttle-9e276cae.js";import"./light-64b8c660.js";import"./light-432a397e.js";const ye=A({setup(){const a=n("icon"),l=n([]);S(()=>a.value,()=>{m()}),I(()=>{m()});const s=n(!1),m=()=>{s.value=!0,i.api.files(a.value).get().then(({data:e})=>{l.value=e,s.value=!1})},o=n(!1),v=async e=>{if(a.value==="icon"){if(e.file.file?.type.startsWith("image"))return!0;message.error("只能上传图片文件，请重新上传")}return!1},h=({file:e,event:r})=>{const u=r?.target,{url:p,name:c}=JSON.parse(u.responseText);return e.name=c,e.url=p,l.value.unshift({url:p,name:c}),e};return()=>t(w,{actionsElement:t(M,null,[t(N,{variant:"info",onClick:()=>{o.value=!0},icon:t(k,null,null)},null)])},{default:()=>[t(P,{value:a.value,onUpdateValue:e=>{a.value=e}},{default:()=>[t(d,{tab:"图标",name:"icon"},null),t(d,{tab:"头像",name:"avatar"},null)]}),t(C,{loading:s.value,data:l,columns:[{key:"name",title:"文件名",width:300,ellipsis:{lineClamp:1,tooltip:!0}},{key:"url",title:"URL",render(e){return t(z,{placement:"bottom",class:"max-w-[400px]"},{trigger(){return t("a",{href:e.url,target:"_blank"},[e.url])},default(){return t(g,{bordered:!0},{default:()=>[t(U,{src:e.url},null)]})}})}},{key:"action",title:"操作",width:150,render(e){return t(J,null,{default:()=>[t(O,{onPositiveClick:()=>{i.api.files(a.value)(e.name).delete().then(()=>{message.success("删除成功"),l.value=l.value.filter(r=>r.name!==e.name)})}},{trigger(){return t(D,{text:!0,type:"error",tertiary:!0,size:"tiny"},{default:()=>[f("删除")]})},default(){return`确定要删除 ${e.name} 吗？`}})]})}}]},null),t(x,{closable:!0,closeOnEsc:!0,onClose:()=>{o.value=!1},show:o.value,onUpdateShow:e=>{o.value=e}},{default:()=>[t(g,{title:"文件上传",class:"modal-card sm flex justify-center",closable:!0,onClose:()=>{o.value=!1}},{default:()=>[t(B,{class:"flex flex-col items-center w-full",headers:{authorization:y()||""},action:`${i.endpoint}/files/upload?type=${a.value}`,"directory-dnd":!0,multiple:!0,onBeforeUpload:v,onFinish:h,onError:e=>{const r=e.event?.target;if(e.file.status="error",!r)return message.warning("网络异常"),e.file;const{message:u}=JSON.parse(r.responseText);return message.warning(u),e.file}},{default:()=>[t(E,{class:"flex flex-col items-center justify-center w-full m-auto py-28"},{default:()=>[t(b,{size:"48",depth:"3"},{default:()=>[t(F,null,null)]}),t(T,{class:"mt-2"},{default:()=>[f("点击或者拖动文件到该区域来上传")]})]})]})]})]})]})}});export{ye as default};
