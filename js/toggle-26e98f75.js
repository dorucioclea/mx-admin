import{k as m,ag as N,ah as B,ai as p,y as d,by as M,at as S,U as t,ck as E,n as A,aH as L,bq as R}from"./Button-2747a3c5.js";import{u as x}from"./use-react-2709dd26.js";import{_ as T,$ as U,Z as W,g as $}from"./app-0ff7b4dc.js";import{N as j,I as y,n as q}from"./use-store-ref-0c1782ca.js";import{e as b,u as P,s as C}from"./use-editor-setting-4e6d0894.js";import{_ as w}from"./preload-helper-f651ca80.js";import{u as D}from"./use-save-confirm-9f66d79e.js";import{N as _}from"./Spin-3ddc0370.js";import{t as H}from"./throttle-02eb4430.js";import{b as K}from"./Card-b81187b1.js";import{N as G}from"./Form-72c5e878.js";import{N as J}from"./FormItem-c1d3bab9.js";import{N as Z}from"./Select-dd921eae.js";const Q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},X=p("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",fill:"currentColor"},null,-1),Y=[X],ee=m({name:"FullscreenExitOutlined",render:function(r,o){return N(),B("svg",Q,Y)}}),te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},oe=p("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[p("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296.07 2.572-1.065z"}),p("circle",{cx:"12",cy:"12",r:"3"})],-1),ne=[oe],re=m({name:"Settings",render:function(r,o){return N(),B("svg",te,ne)}}),V={editor:"editor-pref",general:"editor-general"};var s=(e=>(e.monaco="monaco",e.codemirror="codemirror",e.plain="plain",e))(s||{});const k=m({props:{...b,wrapperProps:{type:Object,required:!1}},setup(e){const r=d();let o=M(e.text);S(()=>e.text,l=>{!o&&l&&(o=l)}),D(e.unSaveConfirm,()=>o===e.text);const{general:{setting:{autocorrect:u}}}=P(),i=l=>{u&&l.key==="Enter"&&w(()=>import("./autocorrect-34fb0c16.js"),[]).then(({format:h})=>{const f=h(l.target.value);e.onChange(f)}).catch(()=>{console.log("not support wasm")})};return()=>t("div",e.wrapperProps,[t(j,{onKeydown:i,ref:r,type:"textarea",onInput:l=>void e.onChange(l),value:e.text,class:"h-full"},null)])}}),c={[s.monaco]:null,[s.plain]:null,[s.codemirror]:null},g=e=>{if(c[e])return c[e];switch(e){case"monaco":{const r=E({loader:()=>w(()=>import("./monaco-a16cb7a6.js"),["js/monaco-a16cb7a6.js","js/preload-helper-f651ca80.js","js/index-aa2cb20a.js","js/use-store-ref-0c1782ca.js","js/Button-2747a3c5.js","js/Spin-3ddc0370.js","js/use-save-confirm-9f66d79e.js","js/use-editor-setting-4e6d0894.js","js/throttle-02eb4430.js","js/FormItem-c1d3bab9.js","js/context-07ff35db.js","js/light-6e3a4c51.js","js/InputNumber-a17cc659.js","js/Remove-a535bd80.js","js/Add-0b9f074d.js","js/Switch-824c8baa.js","js/_common-6222e43f.js","assets/use-editor-setting-8179fa28.css"]).then(o=>o.MonacoEditor),loadingComponent:t(_,{strokeWidth:14,show:!0,rotate:!0},null),suspensible:!0});return c[e]=r,r}case"plain":return c[e]=k,k;case"codemirror":{const r=E({loader:()=>w(()=>import("./codemirror-3ef7c727.js").then(o=>o.v),["js/codemirror-3ef7c727.js","js/use-save-confirm-9f66d79e.js","js/use-store-ref-0c1782ca.js","js/Button-2747a3c5.js","js/use-editor-setting-4e6d0894.js","js/throttle-02eb4430.js","js/FormItem-c1d3bab9.js","js/context-07ff35db.js","js/light-6e3a4c51.js","js/InputNumber-a17cc659.js","js/Remove-a535bd80.js","js/Add-0b9f074d.js","js/Switch-824c8baa.js","js/_common-6222e43f.js","assets/use-editor-setting-8179fa28.css","js/preload-helper-f651ca80.js","assets/codemirror-57b15ec7.css"]).then(o=>o.CodemirrorEditor),loadingComponent:t(_,{strokeWidth:14,show:!0,rotate:!0},null),suspensible:!0});return c[e]=r,r}default:return null}};const le=()=>{const e=localStorage.getItem(V.editor);if(!e)return null;try{const r=JSON.parse(e);return Object.keys(s).includes(r)?r:null}catch{return null}},_e=m({name:"EditorToggleWrapper",props:{...b,loading:{type:Boolean,required:!0}},setup(e){const r=le(),o=d(r??s.codemirror),u=d(!1),i=T(),l=d();x(()=>{const n=i.addFloatButton(t("button",{onClick:()=>{u.value=!0}},[t(y,{size:18},{default:()=>[t(re,null,null)]})])),v=i.addFloatButton(t("button",{onClick:()=>{l.value?.$el.requestFullscreen()}},[t(y,{size:18},{default:()=>[t(ee,null,null)]})]));return()=>{i.removeFloatButton(n),i.removeFloatButton(v)}}),x(()=>{document.addEventListener("fullscreenchange",()=>{document.fullscreenElement===l.value?document.documentElement.classList.add("editor-fullscreen"):document.documentElement.classList.remove("editor-fullscreen")})}),S(()=>o.value,H(n=>{localStorage.setItem(V.editor,JSON.stringify(n))},300,{trailing:!0}));const h=d(),{general:f}=P(),F=A(()=>{if(e.loading)return t("div",{class:[C.editor,C.loading]},[t(_,{strokeWidth:14,show:!0,rotate:!0},null)]);switch(o.value){case"monaco":{const n=g(o.value);return t(n,L({ref:h},e),null)}case"plain":{const n=g(o.value);return t(n,e,null)}case"codemirror":{const n=g(o.value);return t(n,e,null)}default:return null}}),I=m({setup(){const n=()=>{u.value=!1},{Panel:v}=f,O=a=>void(o.value=a),z=a=>void(u.value=a);return()=>t($,{transformOrigin:"center",show:u.value,onUpdateShow:z},{default:()=>[t(K,{closable:!0,onClose:n,title:"编辑器设定",style:"max-width: 90vw;width: 500px; max-height: 65vh; overflow: auto",bordered:!1},{default:()=>[t(q,{class:"text-center"},{default:()=>[t(W,{depth:"3"},{default:()=>[R("此设定仅存储在本地！")]})]}),t(G,{labelPlacement:"left",labelWidth:"8rem",labelAlign:"right"},{default:()=>[t(J,{label:"编辑器选择"},{default:()=>[t(Z,{value:o.value,onUpdateValue:O,options:Object.keys(s).map(a=>({key:a,label:a,value:a}))},null)]}),t(v,null,null)]})]})]})}});return()=>{const{setting:n}=f;return t(U,{tag:"div",style:{"--editor-font-size":n.fontSize?`${n.fontSize/14}rem`:"","--editor-font-family":n.fontFamily},class:"editor-wrapper",ref:l},{default:()=>[F.value,t(I,null,null)]})}}});export{_e as E,k as P};
