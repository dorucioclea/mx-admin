import{h as b,y as p,J as N}from"./app-c79d7097.js";import{x as k,k as T,e as L}from"./use-store-ref-10b7967e.js";import{X as x}from"./index-2d02a5c3.js";import{d as m,r,o as y,b as e,Z as d,F as S,aa as C,c as M}from"./create-injection-key-6dff4bbb.js";import{a8 as U,Z as c}from"./Card-720de80b.js";import{N as w}from"./p-d5bd0779.js";import{N as R,a as B}from"./ListItem-3b929c0f.js";import{N as D}from"./Select-a912f9f4.js";import{u as F}from"./use-react-df50bd4a.js";import{socket as i}from"./index-d759a627.js";import{E as v}from"./types-a9f3cfbf.js";import{b as h}from"./index-7c19d076.js";import{N as V,a as g}from"./Tabs-8be888cd.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./light-90743f8c.js";import"./light-b93dede2.js";import"./Tag-945120fa.js";import"./_common-991711fd.js";import"./guard-ba8a6108.js";import"./Add-fbc91806.js";import"./throttle-9e276cae.js";import"./light-64b8c660.js";const E=m({setup(){const o=r([]),l=r(!1),s=async()=>{l.value=!0;const{data:a}=await p.api.health.log.list(t.value).get();o.value=a,l.value=!1};y(()=>{s()});const n=r(""),u=r(!1),t=r("native");return()=>e(S,null,[e(b,{transformOrigin:"center",show:u.value,onUpdateShow:a=>void(u.value=a)},{default:()=>[e(U,{title:"查看日志",class:"modal-card !w-[100rem] !bg-dark-400 !text-white !all:text-white ",bordered:!1,closable:!0,onClose:()=>{u.value=!1}},{default:()=>[e(O,{data:n.value},null)]})]}),e(w,{show:l.value},{default:()=>[e(R,{class:"min-h-[300px] bg-transparent"},{header(){return e(D,{class:"ml-auto w-32",value:t.value,onUpdateValue:a=>{t.value=a,s()},options:[{label:"PM2",value:"pm2"},{label:"系统记录",value:"native"}]},null)},default(){return o.value.map(a=>e(B,{key:a.filename},{default(){return e("div",{class:"flex flex-col"},[e("span",null,[a.filename]),e("span",{class:"text-gray-400 dark:text-gray-600 text-sm grid grid-cols-[5rem,auto]"},[e("span",null,[a.size]),e("span",null,[d("类型："),a.type])])])},suffix(){return e("div",{class:"flex space-x-2"},[e(c,{ghost:!0,type:"success",onClick:()=>{p.api.health.log(t.value).get({params:{filename:a.filename}}).then(f=>{n.value=f,u.value=!0})}},{default:()=>[d("查看")]}),e(c,{ghost:!0,type:"error",onClick:()=>{p.api.health.log(t.value).delete({params:{filename:a.filename}}).then(()=>{o.value.splice(o.value.findIndex(f=>f.filename===a.filename),1)})}},{default:()=>[d("删除")]})])}}))}})]})])}}),O=m({props:{data:{type:String,default:""}},setup(o){const l=r(!0);return y(()=>{setTimeout(()=>{l.value=!1},1e3)}),()=>e("div",{class:"h-[600px] max-h-[70vh] overflow-auto relative"},[l.value?e("div",{class:"w-full flex items-center justify-center h-full"},[e(w,{show:!0,strokeWidth:14},null)]):e(x,{class:"h-full w-full max-h-full",onReady:s=>{s.write(o.data)}},null)])}}),q=m({setup(){const o=(t=!0)=>{i.socket.emit("log",{prevLog:t})};let l;const s=[],n=t=>{l?(s.length>0&&u(l),l.write(t)):s.push(t)},u=t=>{for(;s.length;){const a=s.shift();t.write(a)}};return k(()=>{o(),h.on(v.STDOUT,n)}),F(()=>{const t=()=>{o(!1)};return i.socket.io.on("open",t),()=>{i.socket.io.off("open",t)}}),C(()=>{i.socket.emit("unlog"),h.off(v.STDOUT,n)}),()=>e(x,{darkMode:!0,onReady:t=>{l=t,u(l)}},null)}}),ue=m({setup(){const o=T(),l=M(()=>o.query.tab?.toString()||"0"),s=L();return()=>e(N,null,{default:()=>[e(V,{size:"medium",value:l.value,onUpdateValue:n=>{s.replace({...o,query:{...o.query,tab:n}})}},{default:()=>[e(g,{tab:"日志",name:"0"},{default:()=>[e(E,null,null)]}),e(g,{tab:"实时",name:"1"},{default:()=>[e(q,null,null)]})]})]})}});export{ue as default};
