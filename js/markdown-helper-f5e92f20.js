import{t as B,am as M,a1 as T,J as D,y as P,b3 as U}from"./app-c79d7097.js";import{p as V}from"./use-store-ref-10b7967e.js";import{d as R,r as w,ab as Y,b as t,Z as f,q as $}from"./create-injection-key-6dff4bbb.js";import{N as C}from"./Form-190bf06a.js";import{N as b}from"./FormItem-94ab7cfc.js";import{N as H}from"./Select-a912f9f4.js";import{b as I}from"./p-d5bd0779.js";import{a as _}from"./Upload-98f221c9.js";import{N as O}from"./ButtonGroup-229638a3.js";import{Z as F}from"./Card-720de80b.js";import{N as k}from"./Switch-042989fd.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./light-8a4490bb.js";import"./light-b93dede2.js";import"./Tag-945120fa.js";import"./_common-991711fd.js";import"./Add-fbc91806.js";import"./light-c32ae781.js";import"./utils-8fb188d9.js";import"./light-806b66fd.js";import"./Tooltip-e8ef26b6.js";import"./fade-in-height-expand.cssr-0f44db21.js";import"./_common-6222e43f.js";class W{constructor(o){this.strList=o}parse(o){const s=o,i=/-{3,}\n(.*?)-{3,}\n*(.*)$/gms.exec(s);if(!i)return{text:s};const p=i[1],y=i.pop(),N=p.split(`
`),g=[],v=[];let m=null;const h=N.reduce((e,c)=>{const l=c.trim().split(":").filter(a=>a.length),r=l.length>=2?[l[0],l.slice(1).filter(a=>a.length).join(":").trim()]:[l[0]];if(r.length===2){const[a,n]=r;["date","updated"].includes(a)?e[a]=new Date(n.trim()).toISOString():["categories:","tags:"].includes(a)?m=a==="categories:"?"cate":"tag":e[a]=n.trim()}else{const a=c.trim().replace(/^\s*-\s*/,"");if(["","tags:","categories:"].includes(a))return m=a==="categories:"?"cate":"tag",e;m==="tag"?g.push(a):v.push(a)}return e},{});return h.categories=v,h.tags=g,{meta:h,text:y}}start(){const o=this.strList,s=[];for(const i of o)s.push(this.parse(i));return s}}var x;(function(u){u.Post="post",u.Note="note"})(x||(x={}));const Z=[{value:x.Post,label:"博文"},{label:"日记",value:x.Note}],ve=R(()=>{const u=w(x.Post),o=w([]),s=w([]);function i(e){return new W(e).start().map((l,r)=>{const n=o.value[r].file.name.replace(/\.md$/,"");return l.meta?l.meta.slug=l.meta.slug??n:l.meta={title:n,slug:n},l.meta?.date||(l.meta.date=new Date().toISOString()),l})}const p=B();async function y(e){if(e?.preventDefault(),e?.stopPropagation(),!o.value.length)throw new ReferenceError("fileList is empty");const c=[];for await(const r of o.value){const a=await Promise.resolve(new Promise((n,L)=>{const d=r.file;if(!d){p.error("文件不存在"),L("File is empty");return}const A=d.name.split(".").pop();if(d.type&&d.type!=="text/markdown"||!["md","markdown"].includes(A)){p.error(`只能解析 markdown 文件, 但是得到了 ${d.type}`),L(`File must be markdown. got type: ${d.type}, got ext: ${A}`);return}const E=new FileReader;E.onload=S=>{n(S.target?.result||"")},E.readAsText(d)}));console.log(a),c.push(a)}const l=i(c);p.success("解析完成, 结果查看 console 哦"),s.value=l.map((r,a)=>({...r,filename:o.value[a].file?.name??""})),console.log($(s))}async function N(e){if(e.stopPropagation(),e.preventDefault(),!s.value.length)return p.error("请先解析!!");await P.api.markdown.import.post({data:{type:u.value,data:s.value}}),p.success("上传成功!"),o.value=[]}const g=w(!0),v=w(!1),m=w(!1);async function h(){const e=await P.api.markdown.export.get({params:{slug:m.value,yaml:g.value,show_title:v.value},responseType:"blob"});U(e,"markdown.zip")}return Y(()=>o.value,e=>{e.length==0?s.value=[]:y()}),()=>t(D,null,{default:()=>[t(M,null,{default:()=>[f("从 MarkDown 导入数据")]}),t(C,{labelAlign:"right",labelPlacement:"left",labelWidth:150,class:"max-w-[300px]"},{default:()=>[t(b,{label:"导入到:"},{default:()=>[t(H,{options:Z,value:u.value,onUpdateValue:e=>void(u.value=e)},null)]}),t(b,{label:"准备好了吗."},{default:()=>[t(I,{vertical:!0},{default:()=>[t(_,{multiple:!0,accept:".md,.markdown",onChange:V(e=>{o.value=e.fileList},250),onRemove:e=>{const l=e.file.name,r=s.value.findIndex(a=>a.filename===l);r!=-1&&s.value.splice(r,1)}},{default:()=>[t(O,null,{default:()=>[t(F,{round:!0},{default:()=>[f("先上传")]}),t(F,{onClick:y,disabled:!o.value.length},{default:()=>[f("再解析")]}),t(F,{onClick:N,round:!0,disabled:!s.value.length},{default:()=>[f("最后导入")]})]})]}),t(T,{depth:2,class:"!text-sm"},{default:()=>[f("只能上传markdown文件")]})]})]})]}),t(M,null,{default:()=>[f("导出数据到 Markdown (Hexo YAML Format)")]}),t(C,{labelAlign:"right",labelPlacement:"left",labelWidth:180,class:"max-w-[400px]"},{default:()=>[t(b,{label:"是否包括 yaml header"},{default:()=>[t(k,{value:g.value,onUpdateValue:e=>void(g.value=e)},null)]}),t(b,{label:"是否在第一行显示文章标题"},{default:()=>[t(k,{value:v.value,onUpdateValue:e=>void(v.value=e)},null)]}),t(b,{label:"根据 slug 生成文件名"},{default:()=>[t(k,{value:m.value,onUpdateValue:e=>void(m.value=e)},null)]}),t("div",{class:"text-right w-full"},[t(F,{type:"primary",onClick:h},{default:()=>[f("导出")]})])]})]})});export{ve as default};
