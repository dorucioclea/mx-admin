import{t as h,y as i,H as v,J as B}from"./app-c79d7097.js";import{T as b}from"./title-link-61b4c986.js";import{D as w}from"./delete-confirm-568dac89.js";import{T as x}from"./index-2c962807.js";import{R as d}from"./relative-time-0cb5a8b0.js";import{u as D}from"./use-table-17c69ba1.js";import{k as P}from"./use-store-ref-10b7967e.js";import{H as N}from"./rounded-button-f939e53f.js";import{d as p,ab as O,o as R,b as t,F,a as C,Z as n}from"./create-injection-key-6dff4bbb.js";import{N as L}from"./Popconfirm-8705d822.js";import{Z as M}from"./Card-720de80b.js";import{b as S}from"./p-d5bd0779.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./ExternalLink-42936135.js";import"./endpoint-d1ee6527.js";import"./DataTable-ee8322e1.js";import"./ChevronRight-d32dd5c3.js";import"./Checkbox-130849a4.js";import"./light-4a540c7a.js";import"./light-dcf71249.js";import"./light-758cc2d5.js";import"./light-b93dede2.js";import"./light-806b66fd.js";import"./Select-a912f9f4.js";import"./Tag-945120fa.js";import"./_common-991711fd.js";import"./Pagination-b72c8488.js";import"./Forward-d74203eb.js";import"./prop-8b8caa29.js";import"./Tooltip-e8ef26b6.js";import"./light-432a397e.js";const ce=p({name:"PageList",setup(){const{checkedRowKeys:s,data:c,pager:l,sortProps:a,fetchDataFn:f}=D((r,e)=>async(y=m.query.page||1,T=20)=>{const k=await i.api.pages.get({params:{page:y,size:T,select:"title subtitle _id id created modified slug",...a.sortBy?{sortBy:a.sortBy,sortOrder:a.sortOrder}:{}}});r.value=k.data}),u=h(),m=P(),o=f;O(()=>m.query.page,async r=>{await o(r)}),R(async()=>{await o()});const g=p({setup(){const r=C([{type:"selection",options:["none","all"]},{title:"标题",sortOrder:!1,sorter:"default",key:"title",width:300,render(e){return t(b,{inPageTo:`/pages/edit?id=${e.id}`,title:e.title,externalLinkTo:`/${e.slug}`,id:e.id},null)}},{title:"副标题",key:"subtitle"},{title:"路径",key:"slug",render(e){return`/${e.slug}`}},{title:"创建于",key:"created",sortOrder:"descend",sorter:"default",render(e){return t(d,{time:e.created},null)}},{title:"修改于",key:"modified",sorter:"default",sortOrder:!1,render(e){return t(d,{time:e.modified},null)}},{title:"操作",fixed:"right",key:"id",render(e){return t(S,null,{default:()=>[t(L,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await i.api.pages(e.id).delete(),u.success("删除成功"),await o(l.value.currentPage)}},{trigger:()=>t(M,{text:!0,type:"error",size:"tiny"},{default:()=>[n("移除")]}),default:()=>t("span",{class:"max-w-48"},[n("确定要删除 "),e.title,n(" ?")])})]})}}]);return()=>t(x,{noPagination:!0,columns:r,data:c,onFetchData:o,pager:l,onUpdateCheckedRowKeys:e=>{s.value=e},onUpdateSorter:async e=>{a.sortBy=e.sortBy,a.sortOrder=e.sortOrder}},null)}});return()=>t(B,null,{actions:()=>t(F,null,[t(w,{checkedRowKeys:s.value,onDelete:async()=>{const r=await Promise.allSettled(s.value.map(e=>i.api.pages(e).delete()));for(const e of r)e.status==="rejected"&&u.success(`删除失败，${e.reason.message}`);s.value.length=0,o()}},null),t(N,{to:"/pages/edit",icon:t(v,null,null)},null)]),default:()=>t(g,null,null)})}});export{ce as ManagePageListView};
