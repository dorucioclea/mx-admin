import{q as B,a0 as T,K as D,x as M,aZ as U}from"./app-976c8860.js";import{m as P,A as V}from"./use-store-ref-4b184b85.js";import{k as R,y as w,at as Y,U as t,br as f,aO as k,by as $}from"./Button-b701b7aa.js";import{N as C}from"./Form-1e2d1f39.js";import{N as b}from"./FormItem-339a3c72.js";import{N as H}from"./Select-a2a95bdb.js";import{a as I}from"./Spin-6ba2d125.js";import{a as O}from"./Upload-6895b33f.js";import{N as _}from"./ButtonGroup-ded3106c.js";import{N}from"./Switch-4fc87e76.js";import"./preload-helper-f651ca80.js";import"./Card-6ffecc90.js";import"./context-079b71da.js";import"./light-b0b9390b.js";import"./light-a088cd9f.js";import"./Tag-0091d0ba.js";import"./_common-991711fd.js";import"./Add-d391d557.js";import"./light-fbe46f12.js";import"./utils-077c54a7.js";import"./light-a589b0af.js";import"./Tooltip-b62453d8.js";import"./fade-in-height-expand.cssr-6c471cc5.js";import"./_common-6222e43f.js";class W{constructor(o){this.strList=o}parse(o){const s=o,i=/-{3,}\n(.*?)-{3,}\n*(.*)$/gms.exec(s);if(!i)return{text:s};const p=i[1],y=i.pop(),F=p.split(`
`),g=[],v=[];let m=null;const h=F.reduce((e,c)=>{const l=c.trim().split(":").filter(a=>a.length),r=l.length>=2?[l[0],l.slice(1).filter(a=>a.length).join(":").trim()]:[l[0]];if(r.length===2){const[a,n]=r;["date","updated"].includes(a)?e[a]=new Date(n.trim()).toISOString():["categories:","tags:"].includes(a)?m=a==="categories:"?"cate":"tag":e[a]=n.trim()}else{const a=c.trim().replace(/^\s*-\s*/,"");if(["","tags:","categories:"].includes(a))return m=a==="categories:"?"cate":"tag",e;m==="tag"?g.push(a):v.push(a)}return e},{});return h.categories=v,h.tags=g,{meta:h,text:y}}start(){const o=this.strList,s=[];for(const i of o)s.push(this.parse(i));return s}}var x;(function(u){u.Post="post",u.Note="note"})(x||(x={}));const q=[{value:x.Post,label:"博文"},{label:"日记",value:x.Note}],ve=R(()=>{const u=w(x.Post),o=w([]),s=w([]);function i(e){return new W(e).start().map((l,r)=>{const n=o.value[r].file.name.replace(/\.md$/,"");return l.meta?l.meta.slug=l.meta.slug??n:l.meta={title:n,slug:n},l.meta?.date||(l.meta.date=new Date().toISOString()),l})}const p=B();async function y(e){if(e?.preventDefault(),e?.stopPropagation(),!o.value.length)throw new ReferenceError("fileList is empty");const c=[];for await(const r of o.value){const a=await Promise.resolve(new Promise((n,A)=>{const d=r.file;if(!d){p.error("文件不存在"),A("File is empty");return}const L=d.name.split(".").pop();if(d.type&&d.type!=="text/markdown"||!["md","markdown"].includes(L)){p.error(`只能解析 markdown 文件，但是得到了 ${d.type}`),A(`File must be markdown. got type: ${d.type}, got ext: ${L}`);return}const E=new FileReader;E.onload=S=>{n(S.target?.result||"")},E.readAsText(d)}));console.log(a),c.push(a)}const l=i(c);p.success("解析完成，结果查看 console 哦"),s.value=l.map((r,a)=>({...r,filename:o.value[a].file?.name??""})),console.log($(s))}async function F(e){if(e.stopPropagation(),e.preventDefault(),!s.value.length)return p.error("请先解析!!");await M.api.markdown.import.post({data:{type:u.value,data:s.value}}),p.success("上传成功！"),o.value=[]}const g=w(!0),v=w(!1),m=w(!1);async function h(){const e=await M.api.markdown.export.get({params:{slug:m.value,yaml:g.value,show_title:v.value},responseType:"blob"});U(e,"markdown.zip")}return Y(()=>o.value,e=>{e.length==0?s.value=[]:y()}),()=>t(D,null,{default:()=>[t(P,null,{default:()=>[f("从 MarkDown 导入数据")]}),t(C,{labelAlign:"right",labelPlacement:"left",labelWidth:150,class:"max-w-[300px]"},{default:()=>[t(b,{label:"导入到:"},{default:()=>[t(H,{options:q,value:u.value,onUpdateValue:e=>void(u.value=e)},null)]}),t(b,{label:"准备好了吗."},{default:()=>[t(I,{vertical:!0},{default:()=>[t(O,{multiple:!0,accept:".md,.markdown",onChange:V(e=>{o.value=e.fileList},250),onRemove:e=>{const l=e.file.name,r=s.value.findIndex(a=>a.filename===l);r!=-1&&s.value.splice(r,1)}},{default:()=>[t(_,null,{default:()=>[t(k,{round:!0},{default:()=>[f("先上传")]}),t(k,{onClick:y,disabled:!o.value.length},{default:()=>[f("再解析")]}),t(k,{onClick:F,round:!0,disabled:!s.value.length},{default:()=>[f("最后导入")]})]})]}),t(T,{depth:2,class:"!text-sm"},{default:()=>[f("只能上传 markdown 文件")]})]})]})]}),t(P,null,{default:()=>[f("导出数据到 Markdown (Hexo YAML Format)")]}),t(C,{labelAlign:"right",labelPlacement:"left",labelWidth:180,class:"max-w-[400px]"},{default:()=>[t(b,{label:"是否包括 yaml header"},{default:()=>[t(N,{value:g.value,onUpdateValue:e=>void(g.value=e)},null)]}),t(b,{label:"是否在第一行显示文章标题"},{default:()=>[t(N,{value:v.value,onUpdateValue:e=>void(v.value=e)},null)]}),t(b,{label:"根据 slug 生成文件名"},{default:()=>[t(N,{value:m.value,onUpdateValue:e=>void(m.value=e)},null)]}),t("div",{class:"text-right w-full"},[t(k,{type:"primary",onClick:h},{default:()=>[f("导出")]})])]})]})});export{ve as default};
