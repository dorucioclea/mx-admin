import{H as i}from"./rounded-button-f939e53f.js";import{ax as I,ay as r,y as u,V as c,az as f,aA as P,J as k,R as y,aB as C}from"./app-c79d7097.js";import{u as N}from"./use-parse-payload-f8b95eb3.js";import{k as T,e as D,f as F}from"./use-store-ref-10b7967e.js";import{i as h}from"./isString-dd690eaa.js";import{d as H,r as q,a1 as B,a as E,c as L,o as M,b as e,F as v,q as z}from"./create-injection-key-6dff4bbb.js";import{N as A}from"./Form-190bf06a.js";import{N as m}from"./FormItem-94ab7cfc.js";import"./Card-720de80b.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./p-d5bd0779.js";import"./light-8a4490bb.js";const Z=H({setup(){const g=T(),p=D(),x=()=>({text:"",author:"",source:""}),s=q({});B(()=>{I([r.原创,r.哲学,r.文学,r.诗词]).then(t=>{s.value={source:t.from,text:t.hitokoto,author:t.from_who||t.creator}})});const w=F(),b=async()=>{const t=async()=>{await u.api.says.post({data:s.value}),message.success("发布成功"),p.push({name:y.ListSay})};a.text||a.author||a.source?w.create({title:"警告",content:"发布一言会覆盖现有的内容, 要继续吗",type:"warning",negativeText:"取消",positiveText:"确定",onPositiveClick(){t()}}):t()},S=t=>N(a)(t),a=E(x()),l=L(()=>g.query.id);M(async()=>{const t=l.value;if(t&&typeof t=="string"){const n=(await u.api.says(t).get({})).data;S(n)}});const d=async()=>{const t=()=>{try{if(!a.text||a.text.trim().length==0)throw"内容为空";return{...C(z(a),(o,n,R)=>(o[R]=typeof n>"u"?null:typeof n=="string"&&n.length==0?"":n,o)),text:a.text.trim()}}catch(o){throw message.error(o),o}};if(l.value){if(!h(l.value))return;const o=l.value;await u.api.says(o).put({data:t()}),message.success("修改成功")}else await u.api.says.post({data:t()}),message.success("发布成功");p.push({name:y.ListSay})};return()=>e(k,{actionsElement:e(v,null,[h(l)?e(i,{name:"更新",variant:"info",onClick:d,icon:e(f,null,null)},null):e(v,null,[e(i,{name:"发布一言",variant:"info",onClick:b,icon:e(P,null,null)},null),e(i,{name:"发布自己说的",variant:"primary",onClick:d,icon:e(f,null,null)},null)])])},{default:()=>[e(A,null,{default:()=>[e(m,{label:"内容",required:!0,labelPlacement:"left",labelStyle:{width:"4rem"}},{default:()=>[e(c,{type:"textarea",autofocus:!0,autosize:{minRows:6,maxRows:8},placeholder:s.value.text,value:a.text,onInput:t=>void(a.text=t)},null)]}),e(m,{label:"作者",labelPlacement:"left",labelStyle:{width:"4rem"}},{default:()=>[e(c,{placeholder:s.value.author,value:a.author,onInput:t=>void(a.author=t)},null)]}),e(m,{label:"来源",labelPlacement:"left",labelStyle:{width:"4rem"}},{default:()=>[e(c,{placeholder:s.value.source,value:a.source,onInput:t=>void(a.source=t)},null)]})]})]})}});export{Z as default};
