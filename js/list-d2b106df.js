import{q as k,x as r,J as w,K as D}from"./app-976c8860.js";import{D as R}from"./delete-confirm-dc2118f8.js";import{T}from"./index-019f837c.js";import{R as F}from"./relative-time-d8a79e8f.js";import{u as N}from"./use-table-25e379fb.js";import{g as B,r as C,k as m}from"./use-store-ref-4b184b85.js";import{H as S}from"./rounded-button-b9dcbed0.js";import{k as c,at as b,R as K,U as t,F as L,B as M,aO as d,br as i}from"./Button-b701b7aa.js";import{N as q}from"./Popconfirm-ef910421.js";import{a as A}from"./Spin-6ba2d125.js";import"./preload-helper-f651ca80.js";import"./Card-6ffecc90.js";import"./DataTable-fbbadfbc.js";import"./ChevronRight-0f5b6e50.js";import"./Checkbox-68906a54.js";import"./light-8f5c5466.js";import"./light-8b77b0de.js";import"./light-8efb1dbb.js";import"./light-a088cd9f.js";import"./light-a589b0af.js";import"./Select-a2a95bdb.js";import"./Tag-0091d0ba.js";import"./_common-991711fd.js";import"./Pagination-6e2c7787.js";import"./Forward-3a0b079d.js";import"./prop-8b8caa29.js";import"./Tooltip-b62453d8.js";import"./light-630c8175.js";const ce=c({name:"SayList",setup(P,V){const{checkedRowKeys:s,data:y,pager:n,loading:f,fetchDataFn:g}=N((a,e)=>async(v=l.query.page||1,x=30)=>{const p=await r.api.says.get({params:{page:v,size:x,select:"title text _id id created modified author source"}});a.value=p.data,e.value=p.pagination}),u=k();B();const l=C(),o=g;b(()=>l.query.page,async a=>{await o(a)}),K(async()=>{await o()});const h=c({setup(){const a=M([{type:"selection",options:["none","all"]},{title:"创建于",key:"created",width:100,render(e){return t(m,{to:`/says/edit?id=${e.id}`},{default:()=>[t(F,{time:e.created},null)]})}},{title:"内容",key:"text"},{title:"作者",key:"author"},{title:"来源",key:"source"},{title:"操作",fixed:"right",key:"id",width:130,render(e){return t(A,{wrap:!1},{default:()=>[t(m,{to:`/says/edit?id=${e.id}`},{default:()=>[t(d,{text:!0,type:"primary",size:"tiny"},{default:()=>[i("编辑")]})]}),t(q,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await r.api.says(e.id).delete(),u.success("删除成功"),await o(n.value.currentPage)}},{trigger:()=>t(d,{text:!0,type:"error",size:"tiny"},{default:()=>[i("移除")]}),default:()=>t("span",{class:"max-w-48"},[i("确定要删除“"),e.text,i("” ?")])})]})}}]);return()=>t(T,{loading:f.value,columns:a,data:y,onFetchData:o,pager:n,onUpdateCheckedRowKeys:e=>{s.value=e}},null)}});return()=>t(D,null,{actions:()=>t(L,null,[t(R,{checkedRowKeys:s.value,onDelete:async()=>{const a=await Promise.allSettled(s.value.map(e=>r.api.says(e).delete()));for(const e of a)e.status==="rejected"&&u.success(`删除失败，${e.reason.message}`);s.value.length=0,o()}},null),t(S,{to:"/says/edit",icon:t(w,null,null)},null)]),default:()=>t(h,null,null)})}});export{ce as default};
