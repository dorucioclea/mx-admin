import{q as C,x as u,D as I,F as N,H as F,J as _,K as R,L as E}from"./app-0ff7b4dc.js";import{T as M}from"./title-link-612f2bc6.js";import{D as L}from"./delete-confirm-1493ed97.js";import{T as j}from"./index-ceac0bb5.js";import{E as H}from"./edit-column-f77fc6c0.js";import{R as P}from"./relative-time-32f0791a.js";import{r as U,i as V,I as T}from"./use-store-ref-0c1782ca.js";import{u as z}from"./use-table-376aa95f.js";import{u as A}from"./category-3dece165.js";import{H as q}from"./rounded-button-fdaf710d.js";import{k as w,ag as K,ah as S,ai as $,at as J,R as G,U as t,F as Q,n as W,B as X,br as Y,bq as m,aO as Z}from"./Button-2747a3c5.js";import{N as ee}from"./Popconfirm-a63323b7.js";import{a as te}from"./Spin-3ddc0370.js";import"./preload-helper-f651ca80.js";import"./Card-b81187b1.js";import"./ExternalLink-0d6156df.js";import"./endpoint-41381714.js";import"./DataTable-f3af239f.js";import"./ChevronRight-c663ceb9.js";import"./Checkbox-1ba0af2c.js";import"./light-926d34ec.js";import"./light-bc440337.js";import"./light-fc2558b5.js";import"./light-a85c2783.js";import"./light-933ab56e.js";import"./Select-dd921eae.js";import"./Tag-e8d95e9c.js";import"./_common-991711fd.js";import"./Pagination-453ed3a6.js";import"./Forward-5521e015.js";import"./prop-8b8caa29.js";import"./Tooltip-2ed5b844.js";import"./light-9e61820c.js";const ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},re=$("path",{d:"M104 224H24c-13.255 0-24 10.745-24 24v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V248c0-13.255-10.745-24-24-24zM64 472c-13.255 0-24-10.745-24-24s10.745-24 24-24s24 10.745 24 24s-10.745 24-24 24zM384 81.452c0 42.416-25.97 66.208-33.277 94.548h101.723c33.397 0 59.397 27.746 59.553 58.098c.084 17.938-7.546 37.249-19.439 49.197l-.11.11c9.836 23.337 8.237 56.037-9.308 79.469c8.681 25.895-.069 57.704-16.382 74.757c4.298 17.598 2.244 32.575-6.148 44.632C440.202 511.587 389.616 512 346.839 512l-2.845-.001c-48.287-.017-87.806-17.598-119.56-31.725c-15.957-7.099-36.821-15.887-52.651-16.178c-6.54-.12-11.783-5.457-11.783-11.998v-213.77c0-3.2 1.282-6.271 3.558-8.521c39.614-39.144 56.648-80.587 89.117-113.111c14.804-14.832 20.188-37.236 25.393-58.902C282.515 39.293 291.817 0 312 0c24 0 72 8 72 81.452z",fill:"currentColor"},null,-1),se=[re],oe=w({name:"ThumbsUp",render:function(n,c){return K(),S("svg",ae,se)}}),Ue=w({name:"PostList",setup(){const{loading:k,checkedRowKeys:n,data:c,pager:g,sortProps:i,fetchDataFn:b}=z((s,r)=>async(e=x.query.page||1,y=20)=>{const a=await u.api.posts.get({params:{page:e,size:y,select:"title _id id created modified slug categoryId copyright tags count pin",...i.sortBy?{sortBy:i.sortBy,sortOrder:i.sortOrder}:{}}});s.value=a.data,r.value=a.pagination}),f=C(),x=U(),o=b;J(()=>x.query.page,async s=>{await o(s)});const l=V(A);G(async()=>{await o(),await l.fetch()});const B=w({setup(){const s=W(()=>l.data.value?.map(e=>({label:e.name,value:e.id}))||[]),r=X([{type:"selection",options:["none","all"]},{title:"标题",sortOrder:!1,sorter:"default",key:"title",width:200,ellipsis:!0,render(e){return t("div",{class:"flex items-center space-x-2"},[e.pin&&t(Y,null,{trigger(){return t(F,{class:"text-orange-400"},{default:()=>[t(_,null,null)]})},default(){return e.pin?t("span",null,[m("置顶于")," ",R(e.pin,"yyyy 年 M 月 d 日 HH:mm:ss")]):null}}),t(M,{id:e.id,title:e.title,inPageTo:`/posts/edit?id=${e.id}`,externalLinkTo:`/posts/${e.category.slug}/${e.slug}`},null)])}},{title:"分类",sortOrder:!1,sorter:"default",key:"category",width:80,ellipsis:!0,filterOptions:s,filter:!0,render(e){return l.map.value?t(H,{returnToConfrim:!1,initialValue:l.map.value.get(e.categoryId)?.name??"",onSubmit:async a=>{await u.api.posts(e.id).patch({data:{categoryId:a}}),f.success("修改成功~!"),c.value.find(h=>h.id===e.id).categoryId=a},type:"select",options:l.data.value?.map(a=>({label:a.name,value:a.id,key:a.id}))||[]},null):""}},{title:"标签",key:"tags",width:100,ellipsis:!0,render(e){return e.tags?.join("，")}},{title:()=>t(T,null,{default:()=>[t(E,null,null)]}),key:"count.read",width:50,render(e){return e.count?.read||0}},{title:()=>t(T,null,{default:()=>[t(oe,null,null)]}),width:50,key:"count.like",render(e){return e.count?.like||0}},{title:"创建于",width:100,key:"created",sortOrder:"descend",sorter:"default",render(e){return t(P,{time:e.created},null)}},{title:"修改于",key:"modified",sorter:"default",sortOrder:!1,width:100,render(e){return t(P,{time:e.modified},null)}},{title:"操作",fixed:"right",width:60,key:"id",render(e){return t(te,null,{default:()=>[t(ee,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await u.api.posts(e.id).delete(),f.success("删除成功"),await o(g.value.currentPage)}},{trigger:()=>t(Z,{text:!0,type:"error",size:"tiny"},{default:()=>[m("移除")]}),default:()=>t("span",{class:"max-w-48"},[m("确定要删除 "),e.title,m(" ?")])})]})}}]);return()=>t(j,{loading:k.value,columns:r,data:c,nTableProps:{onUpdateFilters:async e=>{if(e&&e.category&&Array.isArray(e.category)){if(!e.category.length){await o();return}const a=e.category.join(","),{entries:h}=await u.api.categories.get({params:{ids:a}}),O=Object.values(h).reduce((v,d)=>{const D=d.children?.map(p=>(Object.defineProperty(p,"categoryId",{value:d.id,enumerable:!0}),Object.defineProperty(p,"category",{get(){return p},enumerable:!1}),p));return[...v,...D]},[]).sort((v,d)=>+new Date(v.created)-+new Date(d.created));c.value=O,g.value={currentPage:1,total:1,size:0,hasNextPage:!1,hasPrevPage:!1,totalPage:1}}}},onFetchData:o,pager:g,onUpdateCheckedRowKeys:e=>{n.value=e},onUpdateSorter:async e=>{i.sortBy=e.sortBy,i.sortOrder=e.sortOrder}},null)}});return()=>t(N,null,{actions:()=>t(Q,null,[t(L,{checkedRowKeys:n.value,onDelete:async()=>{const s=await Promise.allSettled(n.value.map(r=>u.api.posts(r).delete()));for(const r of s)r.status==="rejected"&&f.success(`删除失败，${r.reason.message}`);n.value.length=0,o()}},null),t(q,{to:"/posts/edit",icon:t(I,null,null)},null)]),default:()=>t(B,null,null)})}});export{Ue as ManagePostListView};
