import{H as D}from"./rounded-button-f939e53f.js";import{t as F,y as c,am as x,an as R,H as V,J as j,V as C,h as H}from"./app-c79d7097.js";import{t as M}from"./index-2c962807.js";import{h as O,j as q}from"./use-store-ref-10b7967e.js";import{u as L}from"./category-13d05545.js";import{N as P}from"./Tag-945120fa.js";import{N as B}from"./FormItemRow-b51a45c7.js";import{d as E,a as w,r as g,o as U,ab as I,b as e,Z as i,F as Z,ap as _}from"./create-injection-key-6dff4bbb.js";import{a as T}from"./DataTable-ee8322e1.js";import{b as S}from"./p-d5bd0779.js";import{Z as d,a8 as $}from"./Card-720de80b.js";import{N as J}from"./Popconfirm-8705d822.js";import{N as G}from"./Form-190bf06a.js";import"./fade-in.cssr-c6d077ce.js";import"./preload-helper-f651ca80.js";import"./_common-991711fd.js";import"./FormItem-94ab7cfc.js";import"./light-8a4490bb.js";import"./ChevronRight-d32dd5c3.js";import"./Checkbox-130849a4.js";import"./light-4a540c7a.js";import"./light-dcf71249.js";import"./light-758cc2d5.js";import"./light-b93dede2.js";import"./light-806b66fd.js";import"./Select-a912f9f4.js";import"./Pagination-b72c8488.js";import"./Forward-d74203eb.js";import"./prop-8b8caa29.js";import"./Tooltip-e8ef26b6.js";import"./light-432a397e.js";function K(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!_(r)}const Te=E(r=>{const a=O(L),m=w([]),s=g(!0),o=a.fetch,y=F();U(async()=>{s.value=!0,await o(),s.value=!1;const{data:u}=await c.api.categories.get({params:{type:"tag"}});m.push(...u)});const h=g(""),p=w([]);I(()=>h.value,async u=>{if(!u)return;const t=await c.api.categories(u).get({params:{tag:"true"}});p.length=0,p.push(...t.data)});const l=g(!1),N=()=>({name:"",slug:""}),v=g(N());return()=>{let u;return e(j,{actionsElement:e(Z,null,[e(D,{variant:"success",icon:e(V,null,null),onClick:()=>{l.value=!0,v.value=N()}},null)])},{default:()=>[e(x,{prefix:"bar"},{default:()=>[i("分类")]}),e(z,{show:l,onSubmit:async t=>{const{name:n,slug:k}=t,b=typeof l.value=="string"?l.value:null;if(b){await c.api.categories(b).put({data:{name:n,slug:k,type:0}}),y.success("修改成功");const f=a.data.value.findIndex(A=>A.id==b);a.data.value[f]={...a.data.value[f],...t}}else{const f=await c.api.categories.post({data:{name:n,slug:k}});y.success("创建成功"),a.data.value.push(f.data)}},initialState:v.value},null),e(T,{rowClassName:()=>M,bordered:!1,data:a.data.value||[],remote:!0,loading:s.value,columns:[{title:"名称",key:"name"},{title:"数",key:"count"},{title:"路径",key:"slug",width:300},{width:300,title:"操作",fixed:"right",key:"id",render(t){return e(S,{size:12},{default:()=>[e(d,{size:"tiny",text:!0,type:"primary",onClick:n=>{v.value={name:t.name,slug:t.slug},l.value=t.id}},{default:()=>[i("编辑")]}),e(J,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await c.api.categories(t.id).delete(),y.success("删除成功"),await a.fetch(!0)}},{trigger:()=>e(d,{text:!0,type:"error",size:"tiny"},{default:()=>[i("移除")]}),default:()=>e("span",{class:"max-w-48"},[i("确定要删除 "),t.title,i(" ?")])})]})}}]},null),e(x,{prefix:"bar"},{default:()=>[i("标签")]}),e(S,{size:12},K(u=m.map(t=>e(R,{value:t.count,key:t.name},{default:()=>[e(P,{class:"border-gray-200 border",round:!0,type:"success",checkable:!0,bordered:!0,checked:h.value==t.name,onUpdateChecked:n=>{n&&(h.value=t.name)}},{default:()=>[t.name]})]})))?u:{default:()=>[u]}),p.length!=0&&e(T,{remote:!0,class:"mt-4",data:p,columns:[{title:"标题",key:"title",render(t){return e(q,{to:`/posts/edit?id=${t.id}`},{default:()=>[e(d,{type:"primary",text:!0},{default:()=>[t.title]})]})}},{title:"分类",key:"category",render(t){return t.category.name}}]},null)]})}}),z=E(r=>{const a=w(r.initialState??{name:"",slug:""});I(()=>r.initialState,o=>{o&&(a.name=o.name,a.slug=o.slug)});const m=F(),s=()=>{if(!a.name||!a.slug){m.error("名字 和 路径 不能为空");return}r.onSubmit(a),r.show.value=!1};return()=>e(H,{transformOrigin:"center",show:!!r.show.value,onUpdateShow:o=>{r.show.value=o}},{default:()=>e($,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:r.initialState?"编辑":"新建"},{default:()=>[e(G,{onSubmit:s,model:a,rules:{name:{required:!0,trigger:["input","blur"]},slug:{required:!0,trigger:["input","blur"]}}},{default:()=>[e(B,{path:"name",label:"名字"},{default:()=>[e(C,{placeholder:"",onInput:o=>{a.name=o},value:a.name},null)]}),e(B,{path:"slug",label:"路径"},{default:()=>[e(C,{placeholder:"",onInput:o=>{a.slug=o},value:a.slug},null)]}),e("div",{class:"text-center"},[e(S,{size:12,align:"center",inline:!0},{default:()=>[e(d,{type:"success",onClick:s,round:!0},{default:()=>[i("确定")]}),e(d,{onClick:()=>r.show.value=!1,round:!0},{default:()=>[i("取消")]})]})])]})]})})});z.props=["initialState","onSubmit","show"];export{Te as CategoryView};
